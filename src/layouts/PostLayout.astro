---
import Navigation from '../components/layout/Navigation.astro'
import Footer from '../components/layout/Footer.astro'
import MainHead from '../components/MainHead.astro'

import PostHeader from '../components/posts/PostHeader.astro';
import PostEditCard from '../components/posts/PostEditCard.astro';
import PostComments from '../components/posts/PostComments.astro';

const { title, description, heroImage, fileName, pubDate, readTime } = Astro.props;

// og image generation
const ogImageUrl = `https://mykal.codes/api/social-image?title=${title}&description=${description}&image=${heroImage}&pubDate=${pubDate}&readTime=${readTime}&type=post`;
const encodedOgImageUrl = encodeURI(ogImageUrl);
---
<html class="" lang="en">
  <head>
    <MainHead title={title} description={description} />
    <script>
    // image dynamic loading 
    const loadingImages = document.querySelectorAll('img.loading');
    loadingImages.forEach((loadingImageEl) => {
      const hqImageUrl = loadingImageEl.dataset.lazy;
      if(hqImageUrl) loadingImageEl.src = hqImageUrl;
      loadingImageEl.classList.remove('loading')
    })
    </script>

    <!-- OG Image Stuff -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content='https://mykal.codes' />
    <meta property="og:image" content={encodedOgImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter specific OG -->
    <meta name="twitter:card" content="summary_large_image">
  </head>
  <body class="site-container">
    <Navigation />
    <PostHeader {title} {description} {heroImage} {pubDate} {readTime} />
    <main class="container blog-post">
      <slot />
    </main>
    <section class="container">
      <PostEditCard fileName={`posts${fileName}`} />
      <PostComments />
    </section>
    <Footer />
  </body>
</html>
